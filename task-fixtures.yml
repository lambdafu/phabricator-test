# Configuration options here are not locked and can be set in the database.

- name: copy scripts
  synchronize:
    src: bin
    dest: "{{phab_home}}"

- name: copy fixtures
  synchronize:
    src: "{{fixtures}}/"
    dest: "{{phab_home}}/fixtures"

- name: patch phabricator
  become_user: "{{daemon_user}}"
  patch: basedir={{phab}} strip=1 src=D10754.diff
  notify: restart phabricator

- name: set up users
  become_user: "{{daemon_user}}"
  command: chdir={{phab_home}} php ./bin/import-users fixtures/users.json
  notify: restart phabricator
  register: importusers

- debug: var=importusers.stdout_lines

- name: set up projects
  become_user: "{{daemon_user}}"
  command: chdir={{phab_home}} php ./bin/import-projects fixtures/projects.json
  notify: restart phabricator
  register: importprojects

- debug: var=importprojects.stdout_lines

- name: set up tasks
  become_user: "{{daemon_user}}"
  command: chdir={{phab_home}} php ./bin/import-tasks fixtures/tasks.json
  notify: restart phabricator
  register: importtasks

- debug: var=importtasks.stdout_lines

- name: set up files
  become_user: "{{daemon_user}}"
  shell: chdir={{phab_home}} php ./bin/import-files fixtures/files/*
  notify: restart phabricator
  register: importfiles

- debug: var=importfiles.stdout_lines
